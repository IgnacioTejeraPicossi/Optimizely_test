# Playwright E2E tests — Optimizely Demo CMS

E2E tests for the **public site** and **CMS UI** (Enonic-style plan adapted for Optimizely CMS 12 / ASP.NET Core). The app must be running before tests (e.g. `dotnet run` from the repo root).

## What is tested

| Area | Description |
|------|-------------|
| **Public site** | Home load, headings, nav (Home, Search, About Me, AI tools, My Hobbies, Contact Me), hero block render, visual snapshot |
| **CMS UI** | Login (setup + storageState), create Hero Block, add block to Home, publish (scaffold; use codegen to complete) |

## Prerequisites

- Node.js 18+
- App running at **https://localhost:5000** (see `Properties/launchSettings.json`; or set `BASE_URL`)

## Setup

```bash
cd tests-playwright
npm install
npx playwright install chromium
```

## Run tests

**All tests (public only by default; CMS tests need auth):**
```bash
npm run test
```

**Public site only (no login):**
```bash
npm run test:public
```

**CMS tests (run login setup first):**
```powershell
$env:CMS_USER="admin"
$env:CMS_PASS="YourPassword"
npm run cms:login
npm run test:cms
```

**UI mode:**
```bash
npm run test:ui
```

**Update visual snapshots:**
```bash
npm run snap:update
```

**View last report:**
```bash
npm run report
```

## Configuration

- **baseURL:** `process.env.BASE_URL` or `https://localhost:5000` (`playwright.config.ts`; must match app URL)
- **HTTPS:** `ignoreHTTPSErrors: true` for local dev
- **Stability:** `test-utils/stabilize.ts` disables animations and waits for networkidle before assertions/screenshots

## Structure

```
tests-playwright/
├── package.json
├── playwright.config.ts
├── tsconfig.json
├── README.md
├── tests/
│   ├── public/           # Public site (fast, no login)
│   │   ├── home.spec.ts
│   │   ├── navigation.spec.ts
│   │   ├── hero-block-render.spec.ts
│   │   └── home.visual.spec.ts
│   └── cms/               # CMS UI (requires login.setup first)
│       ├── login.setup.ts
│       ├── create-hero-block.spec.ts
│       ├── add-block-to-home.spec.ts
│       └── publish-home.spec.ts
├── test-utils/
│   ├── stabilize.ts       # Anti-flakiness: animations off, networkidle
│   └── selectors.ts       # data-testid selectors for public site
└── storage/
    └── auth.json          # Generated by login.setup (gitignored)
```

## Completing CMS tests with codegen

To fill in the skipped CMS tests with real selectors:

```bash
npx playwright codegen http://localhost:5000/episerver/cms
```

Log in, then perform: open Home → Hero Area → Create new Hero Block → fill fields → Create/Publish. Use the generated selectors in `create-hero-block.spec.ts`, `add-block-to-home.spec.ts`, and `publish-home.spec.ts`.

## Backlog (by area)

- **Public:** Search page (empty query / with results), responsive viewport, 404.
- **CMS:** Full create → add → publish → verify on public.
- **Stability:** Deterministic waits, test data isolation (unique names).
- **Optional:** A11y (axe-core), performance smoke, static asset checks.
